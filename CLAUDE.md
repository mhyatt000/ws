# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a ROS 2 Humble workspace managed with [Pixi](https://prefix.dev/) — a reproducible package manager. It bundles ROS 2 desktop tools, MoveIt 2, Gazebo, and perception/manipulation utilities into a deterministic environment via conda-forge/robostack channels and a lockfile.

## Common Commands

All tasks run through Pixi. First activate the environment with `pixi shell`.

### Environment
```bash
pixi install          # Install all dependencies from pixi.lock
pixi shell            # Activate environment (sources install/setup.sh and env.sh)
```

### Building
```bash
pixi run build        # colcon build --symlink-install
pixi run ws_build     # Build from project root
```

### Workspace / Source Management
```bash
pixi run ws_init      # Initialize empty src/ directory
pixi run ws_import    # Import repos from ws.repos using vcs
pixi run ws_pull      # Update all imported packages
pixi run ws_export    # Snapshot current src/ to ws.repos
pixi run ws_pin       # Generate exact commit pins to ws.pinned.repos
pixi run ws_status    # Check repo states
pixi run ws_clean     # Remove build/, install/, log/
```

### Running
TODO

### Code Formatting
- C++: `ament_clang_format`
- Python: `ruff`

## Architecture

### Environment
- **ROS_DOMAIN_ID**: 69 (set in `env.sh`)
- Environments defined in `pixi.toml`: `default` (Linux-64)

### Source Packages (`src/`)
Packages are not committed here — they are imported via `vcs` from `ws.repos`. Key categories:
- **Robot control**: xarm_ros2, xarm7_servo_demo, ros2_roboreg, franka_spacemouse
- **Motion planning**: moveit2, moveit_task_constructor, moveit_visual_tools
- **Perception/calibration**: apriltag_ros, kalibr, easy_handeye2
- **Custom nodes**: xnodes (symlinked from external repo at `spacemouse_publisher/`)

### Configuration
- `config/cam.yaml` — three camera feeds (low, side, over) with calibration URLs and framerates
- `ws.repos` — VCS manifest for importing source packages
- `ws.pinned.repos` — exact commit pins for reproducibility

### Build Outputs
`build/`, `install/`, and `log/` are generated by colcon and should not be committed.

## Contributing

- Branch naming: `feature/<short-description>` or `fix/<short-description>`
- Rebase onto `main` before opening a PR
- Conventional commit prefixes: `feat:`, `fix:`, `docs:`
- Simulation assets and bag files belong outside the repo (e.g., `~/ros_data`)
